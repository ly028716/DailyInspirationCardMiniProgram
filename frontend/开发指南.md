# 微信小程序前端开发指南

## 📱 项目结构

```
frontend/
├── app.js                 # 应用逻辑
├── app.json              # 应用配置
├── app.wxss             # 全局样式
├── project.config.json  # 项目配置
├── assets/              # 静态资源
│   ├── images/          # 图片资源
│   ├── icons/           # 图标资源
│   └── fonts/           # 字体文件
├── components/          # 公共组件
│   ├── card/            # 卡片组件
│   ├── button/          # 按钮组件
│   └── loading/         # 加载组件
├── pages/               # 页面目录
│   ├── index/           # 首页
│   ├── card/            # 卡片详情
│   ├── history/         # 历史记录
│   ├── profile/         # 个人中心
│   └── settings/        # 设置页面
└── utils/               # 工具函数
    ├── api.js           # API封装
    ├── storage.js       # 本地存储
    └── tools.js         # 通用工具
```

## 🚀 快速开始

### 1. 环境准备
```bash
# 安装微信开发者工具
# 官网下载：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

# 导入项目
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 frontend 目录
4. 填写 AppID（测试可使用测试号）
```

### 2. 配置API地址
编辑 `frontend/utils/api.js`：

```javascript
// 开发环境
const BASE_URL = 'https://api.example.com';

// 生产环境
// const BASE_URL = 'https://your-domain.com';
```

### 3. 安装依赖
微信小程序原生开发，无需额外依赖。

## 🏗️ 页面开发

### 首页（index）

#### 文件结构
```
pages/index/
├── index.wxml    # 页面结构
├── index.wxss    # 页面样式
├── index.js      # 页面逻辑
└── index.json    # 页面配置
```

#### 核心功能
- 展示今日卡片
- 卡片切换
- 点赞收藏
- 分享功能

#### 代码示例
```javascript
// pages/index/index.js
Page({
  data: {
    card: null,
    isLoading: true,
    isLiked: false,
    isFavorited: false
  },

  onLoad() {
    this.loadTodayCard();
  },

  async loadTodayCard() {
    try {
      const res = await wx.request({
        url: `${getApp().globalData.baseUrl}/cards/daily`,
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('token')}`
        }
      });
      
      this.setData({
        card: res.data.data,
        isLoading: false
      });
    } catch (error) {
      console.error('加载卡片失败:', error);
    }
  }
});
```

### 卡片详情页（card）

#### 功能特点
- 全屏展示
- 手势操作
- 评论互动
- 背景切换

#### 手势支持
```javascript
// 左右滑动切换卡片
onSwiperChange(e) {
  const currentIndex = e.detail.current;
  this.loadCard(currentIndex);
},

// 双击点赞
onDoubleTap() {
  this.toggleLike();
}
```

### 历史记录页（history）

#### 功能设计
- 瀑布流布局
- 搜索筛选
- 批量操作
- 缓存优化

#### 性能优化
```javascript
// 虚拟滚动
onScrollToLower() {
  if (!this.data.isEnd) {
    this.loadMoreCards();
  }
},

// 图片懒加载
onImageLoad(e) {
  const index = e.currentTarget.dataset.index;
  this.setData({
    [`cards[${index}].loaded`]: true
  });
}
```

## 🎨 样式规范

### 设计系统
```css
/* 颜色变量 */
:root {
  --primary-color: #FF8C42;
  --secondary-color: #4ECDC4;
  --background-color: #F5F5F5;
  --text-primary: #333333;
  --text-secondary: #666666;
  --border-color: #E0E0E0;
}

/* 间距规范 */
.spacing-xs { margin: 8rpx; }
.spacing-sm { margin: 16rpx; }
.spacing-md { margin: 24rpx; }
.spacing-lg { margin: 32rpx; }

/* 字体规范 */
.text-xs { font-size: 24rpx; }
.text-sm { font-size: 28rpx; }
.text-md { font-size: 32rpx; }
.text-lg { font-size: 36rpx; }
.text-xl { font-size: 48rpx; }
```

### 响应式设计
```css
/* 适配不同屏幕 */
@media (min-width: 375rpx) and (max-width: 414rpx) {
  .card-container {
    padding: 20rpx;
  }
}

@media (min-width: 414rpx) {
  .card-container {
    padding: 24rpx;
  }
}
```

## 🔧 组件开发

### 卡片组件（card）

#### 组件结构
```json
{
  "component": true,
  "usingComponents": {}
}
```

#### 属性定义
```javascript
Component({
  properties: {
    cardData: {
      type: Object,
      value: {}
    },
    showActions: {
      type: Boolean,
      value: true
    }
  },

  methods: {
    onLike() {
      this.triggerEvent('like', { cardId: this.data.cardData.id });
    },
    
    onFavorite() {
      this.triggerEvent('favorite', { cardId: this.data.cardData.id });
    }
  }
});
```

### 加载组件（loading）

#### 动画效果
```css
@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.loading-spinner {
  animation: rotate 1s linear infinite;
}
```

## 📡 API封装

### 请求封装
```javascript
// utils/api.js
class ApiService {
  constructor() {
    this.baseUrl = getApp().globalData.baseUrl;
  }

  async request(options) {
    const token = wx.getStorageSync('token');
    
    return new Promise((resolve, reject) => {
      wx.request({
        url: `${this.baseUrl}${options.url}`,
        method: options.method || 'GET',
        data: options.data || {},
        header: {
          'Content-Type': 'application/json',
          'Authorization': token ? `Bearer ${token}` : '',
          ...options.header
        },
        success: (res) => {
          if (res.statusCode === 200) {
            resolve(res.data);
          } else {
            reject(res.data);
          }
        },
        fail: reject
      });
    });
  }

  // 卡片相关API
  async getDailyCard() {
    return this.request({ url: '/cards/daily' });
  }

  async getHistoryCards(page = 1) {
    return this.request({ url: `/cards/history?page=${page}` });
  }

  async toggleFavorite(cardId) {
    return this.request({
      url: `/cards/${cardId}/favorite`,
      method: 'POST'
    });
  }
}

module.exports = new ApiService();
```

## 🗃️ 数据管理

### 本地存储
```javascript
// utils/storage.js
class StorageService {
  setUserInfo(userInfo) {
    wx.setStorageSync('userInfo', userInfo);
  }

  getUserInfo() {
    return wx.getStorageSync('userInfo') || {};
  }

  setSettings(settings) {
    wx.setStorageSync('settings', settings);
  }

  getSettings() {
    return wx.getStorageSync('settings') || {
      theme: 'light',
      fontSize: 'medium',
      notifications: true
    };
  }
}
```

### 全局状态管理
```javascript
// app.js
App({
  globalData: {
    userInfo: null,
    settings: {},
    baseUrl: 'https://api.example.com'
  },

  onLaunch() {
    // 初始化云开发
    if (!wx.cloud) {
      console.error('请使用 2.2.3 或以上的基础库以使用云能力');
    } else {
      wx.cloud.init({
        env: 'your-cloud-env-id',
        traceUser: true,
      });
    }

    // 检查登录状态
    this.checkLogin();
  },

  async checkLogin() {
    const token = wx.getStorageSync('token');
    if (token) {
      // 验证token有效性
      try {
        await this.globalData.api.verifyToken();
      } catch (error) {
        this.login();
      }
    } else {
      this.login();
    }
  },

  async login() {
    wx.login({
      success: async (res) => {
        if (res.code) {
          try {
            const result = await this.globalData.api.login(res.code);
            wx.setStorageSync('token', result.token);
            this.globalData.userInfo = result.userInfo;
          } catch (error) {
            console.error('登录失败:', error);
          }
        }
      }
    });
  }
});
```

## 🎭 主题切换

### 主题配置
```javascript
// utils/theme.js
const themes = {
  light: {
    '--bg-color': '#FFFFFF',
    '--text-color': '#333333',
    '--card-bg': '#F5F5F5',
    '--border-color': '#E0E0E0'
  },
  dark: {
    '--bg-color': '#1A1A1A',
    '--text-color': '#FFFFFF',
    '--card-bg': '#2C2C2C',
    '--border-color': '#404040'
  },
  auto: {
    // 跟随系统
  }
};

function applyTheme(theme) {
  const themeConfig = themes[theme] || themes.light;
  Object.keys(themeConfig).forEach(key => {
    wx.setStorageSync(key, themeConfig[key]);
  });
}
```

## 📱 适配优化

### 刘海屏适配
```css
.safe-area {
  padding-top: constant(safe-area-inset-top);
  padding-top: env(safe-area-inset-top);
}
```

### 字体大小适配
```javascript
// 监听系统字体大小变化
wx.onThemeChange((result) => {
  this.setData({
    theme: result.theme
  });
});
```

## 🚀 性能优化

### 图片优化
```javascript
// 使用webp格式
const imageUrl = originalUrl.replace('.jpg', '.webp');

// 压缩图片
wx.compressImage({
  src: imageUrl,
  quality: 80,
  success: (res) => {
    console.log('压缩成功', res.tempFilePath);
  }
});
```

### 分包加载
```json
// app.json
{
  "subPackages": [
    {
      "root": "pages/settings",
      "pages": ["index", "theme", "font"]
    }
  ]
}
```

## 🧪 调试工具

### 开发调试
```javascript
// 开启调试模式
wx.setEnableDebug({
  enableDebug: true
});

// 性能监控
const performance = wx.getPerformance();
const observer = performance.createObserver((entryList) => {
  const entries = entryList.getEntries();
  // 分析性能数据
});
observer.observe({ entryTypes: ['render', 'navigation'] });
```

## 📋 发布检查清单

### 功能检查
- [ ] 所有页面功能正常
- [ ] API接口调用无误
- [ ] 用户登录流程完整
- [ ] 分享功能正常

### 性能检查
- [ ] 首屏加载时间 < 3秒
- [ ] 图片资源已优化
- [ ] 分包加载配置正确
- [ ] 无内存泄漏

### 体验检查
- [ ] 适配不同屏幕尺寸
- [ ] 夜间模式正常切换
- [ ] 手势操作响应灵敏
- [ ] 错误提示友好

### 合规检查
- [ ] 用户隐私协议
- [ ] 内容安全审核
- [ ] 小程序类目正确
- [ ] 版本号更新

## 🔗 相关文档

- [UI原型图文档](../docs/UI原型图文档.md)
- [API文档](../docs/API文档.md)
- [部署指南](../docs/部署指南.md)